{% load i18n %}
{% load bootstrap3 %}
{% load static %}
{% bootstrap_icon "plus" as glyphicon_plus %}
{% bootstrap_icon "download" as glyphicon_download %}
{% bootstrap_icon "info-sign" as glyphicon_info_sign %}
{% bootstrap_icon "pencil" as glyphicon_pencil %}

<div class="hidden remove-me">
	<modal-content id="add-flashcard-{{ lesson.id }}">
		<modal-head>
			{% trans "Add Flashcard" %}
		</modal-head>

		<form class="modal-form" action="{% url 'lessons:add_flashcard' %}" method="POST" enctype="multipart/form-data">
		<modal-body>
			{% csrf_token %}
			<div class="row">
				<div class="col-xs-12 vertical-center">
					<span id="loading-text">
						{% trans "Loading image..." %}
					</span>
					<img class="add-flashcard-preview-image flashcard-preview-image" src="{% static 'images/no-preview-image.png' %}" data-original-src="{% static 'images/no-preview-image.png' %}" alt="No preview image">
				</div>
			</div>
			<input type="hidden" name="lesson_id" value="{{ lesson.id }}" />
			<input type="hidden" name="course_id" value="{{ course.id }}" />
			{% bootstrap_field lesson.add_flashcard_form.picture %}
			{% bootstrap_field lesson.add_flashcard_form.label addon_after=glyphicon_pencil placeholder="Baskbetball" %}
			{% bootstrap_field lesson.add_flashcard_form.notes addon_after=glyphicon_pencil placeholder="Sports" %}
			{% bootstrap_field lesson.add_flashcard_form.flashcard_type %}
			{% bootstrap_field lesson.add_flashcard_form.orientation %}
			<div class="form-group">
				<label class="control-label" for="id_is_bordered">
					{% trans "Flashcard Border" %}
				</label><br/>
				{{ lesson.add_flashcard_form.is_bordered }}
			</div>
		</modal-body>

		<modal-footer>
			
		</modal-footer>
		</form>
	</modal-content>
</div>
<br/>
<div class="row">
	<div class="col-sm-5 page-subsubheader-left">
		{% trans "Flashcards" %}
	</div>
	<div class="col-sm-7 page-subsubheader-right">
		{% if lesson.existing_flashcard_dropdown %}
		<button 
			name="add-existing-flashcard"
			type="button" 
			class="btn btn-tertiary" 
			data-toggle="modal" 
			data-target="#add-existing-flashcard">
				{% bootstrap_icon "link" %} {% trans "Add Existing Flashcard" %}
		</button>
		{% endif %}
		{% if lesson.flashcard_lessons %}
		<a href="/lessons/download_all_flashcards/{{ lesson.id }}">
			<button 
				type="button" 
				name="download-all-flashcards"
				class="btn btn-secondary download-all">
					{{ glyphicon_download }} {% trans "Download All" %}
			</button>
		</a>		
		{% endif %}
		<button 
			type="button" 
			class="btn btn-primary" 
			data-toggle="modal" 
			data-target="#add-flashcard-{{ lesson.id }}"
			data-lesson-id="{{ lesson.id }}">
				{{ glyphicon_plus }} {% trans "Add Flashcard" %}
		</button>
	</div>
</div>
<div class="hidden remove-me">
	<modal-content id="add-existing-flashcard">
		<modal-head>
			{% trans "Add A Previously Uploaded Flashcard" %}
		</modal-head>

		<form class="modal-form" action="{% url 'lessons:add_existing_flashcard' %}" method="POST">
		<modal-body>
			{% csrf_token %}
			<input type="hidden" name="lesson_id" value="{{ lesson.id }}"/>

			<div class="form-group">
				<label class="control-label">Select Flashcard</label>
				<select id="flashcard_id" name="flashcard_id" required="" class="form-control">
					{% for flashcard in lesson.existing_flashcard_dropdown %}
					<option value="{{ flashcard.flashcard__id }}">
						{{ flashcard.flashcard__label }} ({{ flashcard.flashcard__notes }}; {{ flashcard.lesson__course__course_code }}, {% trans "Lesson" %} {{ flashcard.lesson__lesson_number }})
					</option>
					{% endfor %}
				</select>
			</div>
		</modal-body>

		<modal-footer>
			
		</modal-footer>
		</form>
	</modal-content>
</div>
{% if lesson.flashcard_lessons %}
	{% with lesson.flashcard_lessons as flashcard_lessons %}
	<table class="table table-hover margin-top-5 flashcard-table">
		<tr>
			<th class="col-xs-2">{% trans "Name" %}</th>
			<th class="col-xs-1 hidden-xs">{% trans "Orientation" %}</th>
			<th class="col-xs-2 hidden-xs">{% trans "Layout" %}</th>
			<th>{% trans "Notes" %}</th>
			<th class="col-xs-5 page-subsubheader-right">{% trans "Actions" %}</th>
		</tr>
		{% for flashcard_lesson in flashcard_lessons %}
		<tr>
			<td>
				{{ flashcard_lesson.flashcard.label }}<br/>
				{% if display_lesson_information %}
					<span class="small text-muted">({{ flashcard_lesson.lesson }})</span>
				{% endif %}
				<div class="hidden remove-me">
					<modal-content id="edit-flashcard-{{ flashcard_lesson.flashcard.id }}">
						<modal-head>
							{% trans "Edit Flashcard" %}
						</modal-head>
						<modal-body>
							
						</modal-body>

						<modal-footer>
							
						</modal-footer>
						</form>
					</modal-content>
				</div>
			</td>
			<td class="hidden-xs">{{ flashcard_lesson.flashcard.get_readable_orientation }}</td>
			<td class="font-size-090 hidden-xs">{{ flashcard_lesson.flashcard.get_readable_layout }}</td>
			<td>{{ flashcard_lesson.flashcard.notes }}</td>
			<td class="page-subsubheader-right">
				<a href="/lessons/delete_flashcard/{{ flashcard_lesson.lesson.id }}/{{ flashcard_lesson.flashcard.id }}">
					<button type="button" class="btn btn-tertiary delete-flashcard-button">
						{% bootstrap_icon "trash" %} {% trans "Delete" %}
					</button>
				</a>
				<a href="/lessons/download_flashcard/{{ flashcard_lesson.flashcard.id }}">
					<button type="button" class="btn btn-secondary download-flashcard-button">
						{{ glyphicon_download }} {% trans "Download" %}
					</button>
				</a>

				<button type="button" 
					class="btn btn-primary edit-flashcard-button"
					data-toggle="modal"
					data-flashcard-id="{{ flashcard_lesson.flashcard.id }}"
					data-target="#edit-flashcard-{{ flashcard_lesson.flashcard.id }}">
						{% bootstrap_icon "edit" %} {% trans "Edit" %}
				</button>
			</td>	
		</tr>
		{% endfor %}
	</table>
	{% endwith %}
{% else %}
<div class="row">
	<div class="col-sm-12 center-align">
		{% trans 'There are no flashcards available for this lesson. <br/> Would you like to' %} <a class="cursor-pointer" data-toggle="modal" data-target="#add-flashcard-{{ lesson.id }}">{% trans 'add a new flashcard?' %}</a>
	</div>
</div>
{% endif %}